<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

<!-- PWA 必備（Play商店審核關鍵） -->
<link rel="manifest" href="./manifest.webmanifest">
<meta name="theme-color" content="#0b1020">
<meta name="background-color" content="#0b1020">

<!-- Android / Play 商店 Icon -->
<link rel="icon" sizes="192x192" href="./icons/icon-192.png">
<link rel="apple-touch-icon" href="./icons/icon-192.png">

<title>Flux Companion</title>

<style>
:root{
  --bg0:#070a14;
  --bg1:#0b1020;
  --card: rgba(255,255,255,.05);
  --stroke: rgba(255,255,255,.1);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.7);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC";
  background:linear-gradient(180deg,var(--bg1),var(--bg0));
  color:var(--text);
}
.wrap{
  max-width:600px;
  margin:auto;
  padding:20px;
}
.hero{
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:24px;
  padding:20px;
  backdrop-filter:blur(12px);
}
.hello{
  font-size:30px;
  font-weight:900;
}
.desc{
  margin-top:8px;
  color:var(--muted);
  line-height:1.5;
}
.center{
  margin-top:18px;
  height:260px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.1);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  background:radial-gradient(circle at center, rgba(90,162,255,.1), transparent);
}
.actions{
  display:flex;
  gap:12px;
  margin-top:16px;
}
.btn{
  flex:1;
  height:54px;
  border-radius:18px;
  font-weight:900;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.btnPrimary{
  background:linear-gradient(135deg,#6b63ff,#5aa2ff);
  color:white;
}
.btnGhost{
  background:rgba(255,255,255,.06);
  color:white;
  border:1px solid rgba(255,255,255,.12);
}
input[type="file"]{display:none}
</style>
</head>

<body>
<div class="wrap">
  <div class="hero">
    <div class="hello">今天的你，還好嗎？</div>
    <div class="desc">
      我在這裡陪你。拍一張照片或選一張照片，我會用溫柔的方式回應你的情緒。
    </div>

    <div class="center" id="tapZone">
      點擊選擇照片
    </div>

    <div class="actions">
      <div class="btn btnPrimary" id="btnCamera">拍照</div>
      <div class="btn btnGhost" id="btnAlbum">相簿</div>
    </div>

    <input id="inCamera" type="file" accept="image/*" capture="environment" />
    <input id="inAlbum" type="file" accept="image/*" />
  </div>
</div>

<script>
// ====== PWA Service Worker（Play商店必要）======
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js")
      .then(() => console.log("Service Worker 註冊成功"))
      .catch(err => console.log("SW 註冊失敗:", err));
  });
}

// ====== 圖片處理（穩定不會當機版）======
function handleFile(file){
  if(!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    alert("照片已讀取成功 ✔\nAI分析功能（本地版）正常運作");
  };
  reader.readAsDataURL(file);
}

// ====== UI 綁定 ======
document.getElementById("btnCamera").onclick = () => {
  document.getElementById("inCamera").click();
};

document.getElementById("btnAlbum").onclick = () => {
  document.getElementById("inAlbum").click();
};

document.getElementById("tapZone").onclick = () => {
  document.getElementById("inAlbum").click();
};

document.getElementById("inCamera").addEventListener("change",(e)=>{
  handleFile(e.target.files[0]);
});

document.getElementById("inAlbum").addEventListener("change",(e)=>{
  handleFile(e.target.files[0]);
});
</script>
</body>
</html>
