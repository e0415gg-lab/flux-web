<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Flux v4.1 Final Stable</title>

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:linear-gradient(180deg,#f5f7fb,#e9edf5);
display:flex;
align-items:center;
justify-content:center;
height:100vh;
text-align:center;
color:#111;
}

.container{
width:100%;
max-width:420px;
padding:24px;
}

.circle{
width:220px;
height:220px;
border-radius:50%;
background:white;
box-shadow:0 10px 30px rgba(0,0,0,0.08);
display:flex;
align-items:center;
justify-content:center;
margin:40px auto;
cursor:pointer;
}

.circle:active{
transform:scale(0.97);
}

.title{
font-size:28px;
font-weight:700;
}

.subtitle{
color:#666;
margin-top:8px;
}

.btn{
width:100%;
padding:16px;
border-radius:16px;
border:none;
background:#111;
color:white;
font-size:18px;
margin-top:12px;
}

.secondary{
background:#ddd;
color:#111;
}

.hidden{
display:none;
}

.score{
font-size:72px;
font-weight:bold;
margin:20px 0;
}
</style>
</head>

<body>

<div class="container" id="home">
<div class="title">Flux</div>
<div class="subtitle">æ‹ä¸‹ä»Šå¤©çš„ç‹€æ…‹</div>

<div class="circle" onclick="openCamera()">
ğŸ“·
</div>

<button class="btn secondary" onclick="openGallery()">å¾ç›¸ç°¿é¸æ“‡</button>

<button class="btn secondary" onclick="openExternal()">ğŸŒ ç”¨ç€è¦½å™¨é–‹å•Ÿï¼ˆé¿å…ç›¸æ©Ÿè¢«é™åˆ¶ï¼‰</button>

<div id="webviewHint" class="subtitle" style="display:none;margin-top:12px;">
ç›®å‰ç‚ºå…§å»ºç€è¦½å™¨ï¼Œæ‹ç…§å¯èƒ½è¢«é™åˆ¶ç‚ºç›¸ç°¿æ¨¡å¼
</div>
</div>

<div id="result" class="container hidden">
<div id="emoji" style="font-size:56px;">ğŸ˜€</div>
<div id="score" class="score">0</div>
<div id="message" class="subtitle">åˆ†æå®Œæˆ</div>
<button class="btn" onclick="goHome()">è¿”å›é¦–é </button>
</div>

<input id="cameraInput" type="file" accept="image/*" capture="environment" class="hidden">
<input id="galleryInput" type="file" accept="image/*" class="hidden">

<script>
function isInAppBrowser(){
const ua=navigator.userAgent||"";
return /Line|FBAN|FBAV|Instagram|Messenger|MicroMessenger/i.test(ua);
}

function openExternal(){
window.open(location.href,"_blank");
alert("è«‹ç”¨ Chrome æˆ– Safari é–‹å•Ÿä»¥ä½¿ç”¨å®Œæ•´ç›¸æ©ŸåŠŸèƒ½");
}

function openCamera(){
document.getElementById("cameraInput").click();
}

function openGallery(){
document.getElementById("galleryInput").click();
}

function isValidTargetImage(file){
if(!file.type.startsWith("image/")) return false;
if(file.size<5000) return false; // å¤ªå°åœ–ç‰‡éæ¿¾
return true;
}

function analyzeFile(file){
if(!file) return;

if(!isValidTargetImage(file)){
alert("è«‹ä¸Šå‚³æœ‰æ•ˆçš„ç›®æ¨™ç…§ç‰‡");
return;
}

// ç©©å®šåˆ†æ•¸ï¼ˆåŒåœ–åŒåˆ†ï¼‰
const seed=file.size%97;
const score=(seed*7+31)%100;

let emoji="ğŸ˜€";
let message="ç‹€æ…‹æ­£å¸¸";

if(score<=30){
emoji="ğŸ¥º";
message="ä»Šæ—¥ç‹€æ…‹åä½ï¼Œå»ºè­°è§€å¯Ÿ";
}else if(score<=60){
emoji="ğŸ˜€";
message="ä»Šæ—¥ç‹€æ…‹ç©©å®š";
}else{
emoji="ğŸ˜†";
message="ä»Šæ—¥ç‹€æ…‹è‰¯å¥½";
}

document.getElementById("score").innerText=score;
document.getElementById("emoji").innerText=emoji;
document.getElementById("message").innerText=message;

document.getElementById("home").classList.add("hidden");
document.getElementById("result").classList.remove("hidden");
}

document.getElementById("cameraInput").addEventListener("change",(e)=>{
analyzeFile(e.target.files[0]);
});

document.getElementById("galleryInput").addEventListener("change",(e)=>{
analyzeFile(e.target.files[0]);
});

if(isInAppBrowser()){
document.getElementById("webviewHint").style.display="block";
}
</script>

</body>
</html>
